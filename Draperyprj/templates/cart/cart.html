{% extends "base.html" %}
{% block title %}Cart - Drapery{% endblock %}

{% block content %}
<h2 class="mb-3">Your Shopping Cart</h2>

{% if not cart_items %}
  <p>Your shopping cart is empty.</p>
  <a href="{% url 'store:product_list' %}" class="btn btn-secondary">Continue Shopping</a>
{% else %}
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Item</th>
          <th>Details</th>
          <th class="text-end">Subtotal</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for cart_item in cart_items %}
        <tr>
          <td style="width: 140px;">
            {% if cart_item.product.product_image %}
              <img src="{{ cart_item.product.product_image.url }}" alt="{{ cart_item.product.product_name }}" class="img-fluid" style="max-width:120px;">
            {% endif %}
          </td>
          <td>
            <strong>{{ cart_item.product.product_name }}</strong><br>
            Unit price: €{{ cart_item.product.price }}<br>
            Qty: {{ cart_item.quantity }}
          </td>
          <td class="text-end">€{{ cart_item.sub_total }}</td>
          <td class="text-end">
            <a href="{% url 'cart:add_cart' cart_item.product.pk %}" class="btn btn-sm btn-outline-primary">+</a>
            <a href="{% url 'cart:decrement_cart' cart_item.product.pk %}" class="btn btn-sm btn-outline-secondary">−</a>
            <a href="{% url 'cart:remove_cart_item' cart_item.product.pk %}" class="btn btn-sm btn-outline-danger">Remove</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="2" class="text-end">Total</th>
          <th class="text-end">€{{ total }}</th>
          <th class="text-end">
            <a href="{% url 'cart:clear_cart' %}" class="btn btn-sm btn-outline-danger">Clear Cart</a>
          </th>
        </tr>
      </tfoot>
    </table>
  </div>

  <a href="{% url 'store:product_list' %}" class="btn btn-secondary">Continue Shopping</a>

  <div class="mt-3 d-grid gap-2">
    <a href="{% url 'orders:checkout' %}" class="btn btn-primary my_custom_button">
      Checkout
    </a>

    <form action="{% url 'cart:cart_detail' %}" method="POST" class="m-0">
      {% csrf_token %}
      <button class="btn btn-secondary my_custom_button" type="submit">
        Pay with card
      </button>
    </form>

    {% if error %}
      <p style="color: red;" class="mb-0">Error: {{ error }}</p>
    {% endif %}
  </div>
{% endif %}
{% endblock %}

